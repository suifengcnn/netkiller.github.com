<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>2.6. Routing</title><link rel="stylesheet" type="text/css" href="..//docbook.css" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><meta name="keywords" content="pix,asa,s5500, vlan,vtp, hsrp,vrrp, rip,ospf" /><link rel="home" href="../index.html" title="Netkiller H3C 手札" /><link rel="up" href="index.html" title="第 2 章 H3C Switch" /><link rel="prev" href="limit.html" title="2.5. 流量控制" /><link rel="next" href="snmp.html" title="2.7. SNMP" /></head><body><a xmlns="" href="http://www.netkiller.cn/">Home</a> |
		<a xmlns="" href="http://netkiller.github.io/">简体中文</a> |
	    <a xmlns="" href="http://netkiller.sourceforge.net/">繁体中文</a> |
	    <a xmlns="" href="/journal/index.html">杂文</a> |
	    <a xmlns="" href="//www.netkiller.cn/home/donations.html">打赏(Donations)</a> |
	    <a xmlns="" href="http://netkiller-github-com.iteye.com/">ITEYE 博客</a> |
	    <a xmlns="" href="http://my.oschina.net/neochen/">OSChina 博客</a> |
	    <a xmlns="" href="https://www.facebook.com/bg7nyt">Facebook</a> |
	    <a xmlns="" href="http://cn.linkedin.com/in/netkiller/">Linkedin</a> |
	    <a xmlns="" href="https://zhuanlan.zhihu.com/netkiller">知乎专栏</a> |
	    <a xmlns="" href="/search.html">Search</a> |
		<a xmlns="" href="mailto:netkiller@msn.com">Email</a><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">2.6. Routing</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="limit.html">上一页</a> </td><th width="60%" align="center">第 2 章 H3C Switch</th><td width="20%" align="right"> <a accesskey="n" href="snmp.html">下一页</a></td></tr></table><hr /></div><table xmlns=""><tr><td><iframe src="http://ghbtns.com/github-btn.html?user=netkiller&amp;repo=netkiller.github.io&amp;type=watch&amp;count=true&amp;size=large" height="30" width="170" frameborder="0" scrolling="0" style="width:170px; height: 30px;" allowTransparency="true"></iframe></td><td><iframe src="http://ghbtns.com/github-btn.html?user=netkiller&amp;repo=netkiller.github.io&amp;type=fork&amp;count=true&amp;size=large" height="30" width="170" frameborder="0" scrolling="0" style="width:170px; height: 30px;" allowTransparency="true"></iframe></td><td><iframe src="http://ghbtns.com/github-btn.html?user=netkiller&amp;type=follow&amp;count=true&amp;size=large" height="30" width="240" frameborder="0" scrolling="0" style="width:240px; height: 30px;" allowTransparency="true"></iframe></td></tr></table><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="routing"></a>2.6. Routing</h2></div></div></div>
		
		<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp18"></a>2.6.1. RIP</h3></div></div></div>
			
			<pre class="screen">
rip 1
 version 2
 network 192.168.20.0
 network 192.168.2.0
			</pre>
		</div>
		<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp19"></a>2.6.2. OSPF</h3></div></div></div>
			
			<pre class="screen">
#
ospf 1
 area 0.0.0.1
  network 192.168.40.240 0.0.0.15
  network 192.168.2.0 0.0.0.255
  network 192.168.3.0 0.0.0.255
  network 192.168.4.0 0.0.0.255
  network 192.168.5.0 0.0.0.255
  network 192.168.6.0 0.0.0.255
  network 192.168.7.0 0.0.0.255
  network 192.168.8.0 0.0.0.255
  network 192.168.9.0 0.0.0.255
  network 172.16.0.0 0.0.0.255
  network 192.168.30.0 0.0.0.255
  network 172.16.100.0 0.0.0.255
#
			</pre>
		</div>
		<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp20"></a>2.6.3. Static</h3></div></div></div>
			
			<pre class="screen">
#
 ip route-static 0.0.0.0 0.0.0.0 192.168.1.1 preference 10 description TC
 ip route-static 0.0.0.0 0.0.0.0 192.168.20.1 preference 20 description UC
 ip route-static 4.4.4.4 255.255.255.255 192.168.40.254 description google dns
 ip route-static 8.8.8.8 255.255.255.255 192.168.40.254 description google dns
 ip route-static 64.4.61.215 255.255.255.255 192.168.40.254
 ip route-static 74.125.71.94 255.255.255.255 192.168.40.254
 ip route-static 192.168.20.0 255.255.255.0 192.168.20.1 description UC
 ip route-static 192.168.30.112 255.255.255.255 192.168.30.254
 ip route-static 203.208.46.146 255.255.255.255 192.168.40.254
#
			</pre>
			<p>浮动路由</p>
			<pre class="screen">
 ip route-static 0.0.0.0 0.0.0.0 192.168.1.1 preference 10 description TC
 ip route-static 0.0.0.0 0.0.0.0 192.168.20.1 preference 20 description UC
			</pre>
		</div>
		<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp21"></a>2.6.4. 策略路由</h3></div></div></div>
			
			<p>案例一</p>
			<pre class="screen">
acl number 3000
 rule 0 permit ip source 192.168.2.1 0
acl number 3001
 rule 0 permit ip source 192.168.6.0 0.0.0.255
#
traffic classifier 2 operator or
 if-match acl 3000
traffic classifier 1 operator and
 if-match acl 3001
#
traffic behavior 1
 redirect next-hop 192.168.40.254
#
qos policy 2
 classifier 2 behavior 1
qos policy 1
 classifier 1 behavior 1
#
interface GigabitEthernet1/0/11
 qos apply policy 1 inbound
#
interface GigabitEthernet1/0/12
 qos apply policy 2 inbound
			</pre>
			<p>取消策略路由</p>
			<pre class="screen">
interface GigabitEthernet1/0/11
un qos apply policy inbound
#
interface GigabitEthernet1/0/12
un qos apply policy inbound

quit
un qos policy 1
un traffic behavior 1
un traffic classifier 1

un acl number 3001
			</pre>
			<p>这个案例是基于源的策略路由</p>
			<p>案例二</p>
			<pre class="screen">
acl number 3010
 rule 0 permit ip source any destination 192.168.0.0 0.0.255.255

acl number 3020
 rule 0 permit ip source 192.168.6.0 0.0.0.255

traffic classifier classifier1 operator or
 if-match acl 3010
traffic classifier classifier2 operator or
 if-match acl 3020

traffic behavior behavior1
 redirect next-hop 192.168.1.1

traffic behavior behavior2
 redirect next-hop 192.168.40.254

qos policy policy1
 classifier classifier1 behavior behavior1
 classifier classifier2 behavior behavior2

interface GigabitEthernet1/0/11
 qos apply policy policy1 inbound
			</pre>
			<p>案例二是一个基于目的的测略路由</p>
		</div>
		<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp22"></a>2.6.5. Debug</h3></div></div></div>
			
			<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="routing-table"></a>2.6.5.1. routing-table</h4></div></div></div>
				
				<pre class="screen">
				
[H3C]display ip routing-table
 Routing Table: public net
Destination/Mask   Protocol Pre  Cost        Nexthop         Interface
0.0.0.0/0          STATIC   60   0           192.168.3.1     Vlan-interface1
127.0.0.0/8        DIRECT   0    0           127.0.0.1       InLoopBack0
127.0.0.1/32       DIRECT   0    0           127.0.0.1       InLoopBack0
192.168.3.0/24     DIRECT   0    0           192.168.3.12    Vlan-interface1
192.168.3.12/32    DIRECT   0    0           127.0.0.1       InLoopBack0
192.168.5.0/24     STATIC   60   0           192.168.3.252   Vlan-interface1
192.168.6.0/24     DIRECT   0    0           192.168.6.254   Vlan-interface6
192.168.6.254/32   DIRECT   0    0           127.0.0.1       InLoopBack0
192.168.7.0/24     DIRECT   0    0           192.168.7.254   Vlan-interface7
192.168.7.254/32   DIRECT   0    0           127.0.0.1       InLoopBack0
192.168.8.0/24     DIRECT   0    0           192.168.8.254   Vlan-interface8
192.168.8.254/32   DIRECT   0    0           127.0.0.1       InLoopBack0
192.168.9.0/24     DIRECT   0    0           192.168.9.254   Vlan-interface9
192.168.9.254/32   DIRECT   0    0           127.0.0.1       InLoopBack0
				
				</pre>
				<pre class="screen">
[H3C-rip-1]display ip routing-table
Routing Tables: Public
	Destinations : 36	Routes : 36

Destination/Mask    Proto  Pre  Cost         NextHop         Interface

0.0.0.0/0           Static 60   0            192.168.1.1     Vlan1
1.1.1.1/32          Direct 0    0            127.0.0.1       InLoop0
4.4.4.4/32          Static 60   0            192.168.40.254  Vlan40
8.8.8.8/32          Static 60   0            192.168.40.254  Vlan40
64.4.61.215/32      Static 60   0            192.168.40.254  Vlan40
74.125.71.94/32     Static 60   0            192.168.40.254  Vlan40
127.0.0.0/8         Direct 0    0            127.0.0.1       InLoop0
127.0.0.1/32        Direct 0    0            127.0.0.1       InLoop0
172.16.0.0/24       OSPF   10   2            192.168.40.254  Vlan40
192.168.1.0/24      Direct 0    0            192.168.1.254   Vlan1
192.168.1.254/32    Direct 0    0            127.0.0.1       InLoop0
192.168.2.0/24      Direct 0    0            192.168.2.254   Vlan2
192.168.2.254/32    Direct 0    0            127.0.0.1       InLoop0
192.168.3.0/24      Direct 0    0            192.168.3.254   Vlan3
192.168.3.254/32    Direct 0    0            127.0.0.1       InLoop0
192.168.4.0/24      Direct 0    0            192.168.4.254   Vlan4
192.168.4.254/32    Direct 0    0            127.0.0.1       InLoop0
192.168.5.0/24      Direct 0    0            192.168.5.254   Vlan5
192.168.5.254/32    Direct 0    0            127.0.0.1       InLoop0
192.168.6.0/24      Direct 0    0            192.168.6.254   Vlan6
192.168.6.254/32    Direct 0    0            127.0.0.1       InLoop0
192.168.7.0/24      Direct 0    0            192.168.7.254   Vlan7
192.168.7.254/32    Direct 0    0            127.0.0.1       InLoop0
192.168.8.0/24      Direct 0    0            192.168.8.254   Vlan8
192.168.8.254/32    Direct 0    0            127.0.0.1       InLoop0
192.168.9.0/24      Direct 0    0            192.168.9.254   Vlan9
192.168.9.254/32    Direct 0    0            127.0.0.1       InLoop0
192.168.20.0/24     Direct 0    0            192.168.20.254  Vlan20
192.168.20.254/32   Direct 0    0            127.0.0.1       InLoop0
192.168.30.0/24     Direct 0    0            192.168.30.1    Vlan30
192.168.30.1/32     Direct 0    0            127.0.0.1       InLoop0
192.168.30.112/32   Static 60   0            192.168.30.254  Vlan30
192.168.40.240/28   Direct 0    0            192.168.40.253  Vlan40
192.168.40.253/32   Direct 0    0            127.0.0.1       InLoop0
192.168.50.128/25   OSPF   10   2            192.168.40.254  Vlan40
203.208.46.146/32   Static 60   0            192.168.40.254  Vlan40
				</pre>
			</div>
		</div>
	</div><div xmlns="" id="disqus_thread"></div><script xmlns="">

var disqus_config = function () {
this.page.url = "http://www.netkiller.cn";  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = 'netkiller'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};

(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = '//netkiller.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script><noscript xmlns="">Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript><br xmlns="" /><script xmlns="" type="text/javascript" id="clustrmaps" src="//cdn.clustrmaps.com/map_v2.js?u=r5HG&amp;d=9mi5r_kkDC8uxG8HuY3p4-2qgeeVypAK9vMD-2P6BYM"></script><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="limit.html">上一页</a> </td><td width="20%" align="center"><a accesskey="u" href="index.html">上一级</a></td><td width="40%" align="right"> <a accesskey="n" href="snmp.html">下一页</a></td></tr><tr><td width="40%" align="left" valign="top">2.5. 流量控制 </td><td width="20%" align="center"><a accesskey="h" href="../index.html">起始页</a></td><td width="40%" align="right" valign="top"> 2.7. SNMP</td></tr></table></div><script xmlns="">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-11694057-1', 'auto');
  ga('send', 'pageview');

</script><script xmlns="" async="async">
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?93967759a51cda79e49bf4e34d0b0f2c";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script xmlns="" async="async">
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script><script xmlns="" type="text/javascript" src="/js/q.js" async="async"></script></body></html>