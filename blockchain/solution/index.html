<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>第 2 章 区块链探索</title><link rel="stylesheet" type="text/css" href="..//docbook.css" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="home" href="../index.html" title="Netkiller Blockchain 手札" /><link rel="up" href="../index.html" title="Netkiller Blockchain 手札" /><link rel="prev" href="../区块链比较.html" title="1.20. Ethereum vs Hypterledger Fabic vs EOS 对比" /><link rel="next" href="trace.html" title="2.2. 区块链防伪溯源应用场景" /></head><body><a xmlns="" href="//www.netkiller.cn/">Home</a> |
		<a xmlns="" href="//netkiller.github.io/">简体中文</a> |
	    <a xmlns="" href="http://netkiller.sourceforge.net/">繁体中文</a> |
	    <a xmlns="" href="/journal/index.html">杂文</a> |
	    <a xmlns="" href="https://zhuanlan.zhihu.com/netkiller">知乎专栏</a> |
	    <a xmlns="" href="https://github.com/netkiller">Github</a> |
	    <a xmlns="" href="http://my.oschina.net/neochen/">OSChina 博客</a> |
	    <a xmlns="" href="https://cloud.tencent.com/developer/column/2078">云社区</a> |
	    <a xmlns="" href="https://yq.aliyun.com/u/netkiller/">云栖社区</a> |
	    <a xmlns="" href="https://www.facebook.com/bg7nyt">Facebook</a> |
	    <a xmlns="" href="http://cn.linkedin.com/in/netkiller/">Linkedin</a> |
	    <a xmlns="" href="//www.netkiller.cn/home/video.html">视频教程</a> |
	    <a xmlns="" href="//www.netkiller.cn/home/donations.html">打赏(Donations)</a> |
	    <a xmlns="" href="//www.netkiller.cn/home/about.html">About</a><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">第 2 章 区块链探索</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="../区块链比较.html">上一页</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="trace.html">下一页</a></td></tr></table><hr /></div><table xmlns=""><tr><td><iframe src="//ghbtns.com/github-btn.html?user=netkiller&amp;repo=netkiller.github.io&amp;type=watch&amp;count=true&amp;size=large" height="30" width="170" frameborder="0" scrolling="0" style="width:170px; height: 30px;" allowTransparency="true"></iframe></td><td><iframe src="//ghbtns.com/github-btn.html?user=netkiller&amp;repo=netkiller.github.io&amp;type=fork&amp;count=true&amp;size=large" height="30" width="170" frameborder="0" scrolling="0" style="width:170px; height: 30px;" allowTransparency="true"></iframe></td><td><iframe src="//ghbtns.com/github-btn.html?user=netkiller&amp;type=follow&amp;count=true&amp;size=large" height="30" width="240" frameborder="0" scrolling="0" style="width:240px; height: 30px;" allowTransparency="true"></iframe></td><td></td><td><a href="https://zhuanlan.zhihu.com/netkiller"><img src="/images/logo/zhihu-card-default.svg" height="25" /></a></td><td valign="middle"><a href="https://zhuanlan.zhihu.com/netkiller">知乎专栏</a> ｜ <a href="https://www.zhihu.com/club/1241768772601950208">多维度架构</a></td><td> | </td><td>微信号 netkiller-ebook  </td><td> | </td><td>QQ群：128659835 请注明“读者”</td></tr></table><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="index"></a>第 2 章 区块链探索</h1></div></div></div><div class="toc"><p><strong>目录</strong></p><dl class="toc"><dt><span class="section"><a href="index.html#logistics">2.1. 以太坊物流场景解决方案</a></span></dt><dt><span class="section"><a href="trace.html">2.2. 区块链防伪溯源应用场景</a></span></dt><dd><dl><dt><span class="section"><a href="trace.html#idp11">2.2.1. 背景</a></span></dt><dt><span class="section"><a href="trace.html#idp12">2.2.2. 如何实现</a></span></dt><dt><span class="section"><a href="trace.html#idp13">2.2.3. 安全问题</a></span></dt><dt><span class="section"><a href="trace.html#idp14">2.2.4. 防伪问题</a></span></dt><dt><span class="section"><a href="trace.html#idp15">2.2.5. 性能问题</a></span></dt><dt><span class="section"><a href="trace.html#idp16">2.2.6. 颗粒度问题</a></span></dt><dt><span class="section"><a href="trace.html#idp17">2.2.7. 存储规划</a></span></dt><dt><span class="section"><a href="trace.html#idp18">2.2.8. 大数据问题</a></span></dt><dt><span class="section"><a href="trace.html#bi">2.2.9. BI商业智能</a></span></dt><dt><span class="section"><a href="trace.html#idp19">2.2.10. 采集终端</a></span></dt><dt><span class="section"><a href="trace.html#idp20">2.2.11. 多媒体数据</a></span></dt><dt><span class="section"><a href="trace.html#idp21">2.2.12. 物流接口</a></span></dt><dt><span class="section"><a href="trace.html#idp22">2.2.13. 如何激励用户</a></span></dt><dt><span class="section"><a href="trace.html#idp23">2.2.14. 上链</a></span></dt><dt><span class="section"><a href="trace.html#idp27">2.2.15. 以太坊解决方案</a></span></dt><dd><dl><dt><span class="section"><a href="trace.html#idp24">2.2.15.1. 应用场景一</a></span></dt><dt><span class="section"><a href="trace.html#idp25">2.2.15.2. 应用场景二</a></span></dt><dt><span class="section"><a href="trace.html#idp26">2.2.15.3. 用户留言</a></span></dt></dl></dd><dt><span class="section"><a href="trace.html#idp28">2.2.16. Hyperledger 解决方案</a></span></dt><dd><dl><dt><span class="section"><a href="trace.html#hyperledger.source">2.2.16.1. 溯源合约涉及</a></span></dt><dd><dl><dt><span class="section"><a href="trace.html#">2.2.16.1.1. 食品安全朔源</a></span></dt><dt><span class="section"><a href="trace.html#">2.2.16.1.2. 水平移植</a></span></dt></dl></dd><dt><span class="section"><a href="trace.html#hyperledger.token">2.2.16.2. 积分通正（代币）</a></span></dt></dl></dd><dt><span class="section"><a href="trace.html#idp29">2.2.17. 总结</a></span></dt></dl></dd><dt><span class="section"><a href="movie.html">2.3. 以太坊·电影院场景区块链应用探索</a></span></dt><dd><dl><dt><span class="section"><a href="movie.html#movie.contact">2.3.1. 合约文件</a></span></dt><dt><span class="section"><a href="movie.html#">2.3.2. 合约用法</a></span></dt></dl></dd><dt><span class="section"><a href="game.html">2.4. 游戏领域区块链探索</a></span></dt><dd><dl><dt><span class="section"><a href="game.html#idp30">2.4.1. 游戏代币</a></span></dt><dt><span class="section"><a href="game.html#idp31">2.4.2. 玩家属性与游戏装备</a></span></dt><dt><span class="section"><a href="game.html#idp32">2.4.3. 装备属性与规范</a></span></dt><dt><span class="section"><a href="game.html#idp33">2.4.4. 物品合成计算</a></span></dt><dt><span class="section"><a href="game.html#idp34">2.4.5. 实施步骤</a></span></dt></dl></dd><dt><span class="section"><a href="guess.html">2.5. 以太坊竞猜活动区块链探索</a></span></dt><dt><span class="section"><a href="point.html">2.6. 使用代币替代传统积分系统</a></span></dt><dd><dl><dt><span class="section"><a href="point.html#idp38">2.6.1. 规划</a></span></dt><dd><dl><dt><span class="section"><a href="point.html#idp35">2.6.1.1. 账号规划</a></span></dt><dt><span class="section"><a href="point.html#idp36">2.6.1.2. 日志规划</a></span></dt><dt><span class="section"><a href="point.html#idp37">2.6.1.3. 监控规划</a></span></dt><dt><span class="section"><a href="point.html#">2.6.1.4. 代币构成规划</a></span></dt></dl></dd><dt><span class="section"><a href="point.html#idp39">2.6.2. 实施步骤</a></span></dt><dt><span class="section"><a href="point.html#idp40">2.6.3. ERC20 代币合约</a></span></dt><dt><span class="section"><a href="point.html#idp41">2.6.4. 打通用户注册</a></span></dt><dt><span class="section"><a href="point.html#idp42">2.6.5. 现有用户怎么处理</a></span></dt><dt><span class="section"><a href="point.html#idp43">2.6.6. 赠送代币</a></span></dt><dt><span class="section"><a href="point.html#idp44">2.6.7. 赚取代币</a></span></dt><dt><span class="section"><a href="point.html#idp45">2.6.8. 用户登录</a></span></dt><dt><span class="section"><a href="point.html#idp46">2.6.9. 积分商城</a></span></dt><dt><span class="section"><a href="point.html#idp49">2.6.10. 代币报表</a></span></dt><dd><dl><dt><span class="section"><a href="point.html#idp47">2.6.10.1. 曾币报表</a></span></dt><dt><span class="section"><a href="point.html#idp48">2.6.10.2. 积分商城报表</a></span></dt></dl></dd><dt><span class="section"><a href="point.html#idp50">2.6.11. 代币交易</a></span></dt></dl></dd><dt><span class="section"><a href="credit.html">2.7. 区块链征信解决方案探索</a></span></dt><dd><dl><dt><span class="section"><a href="credit.html#idp51">2.7.1. 需求分析与概要设计</a></span></dt><dt><span class="section"><a href="credit.html#idp52">2.7.2. 数据结构</a></span></dt><dt><span class="section"><a href="credit.html#idp53">2.7.3. 将征信资料写入区块链</a></span></dt><dt><span class="section"><a href="credit.html#idp54">2.7.4. 查询区块数据</a></span></dt><dt><span class="section"><a href="credit.html#idp55">2.7.5. 删除区块</a></span></dt></dl></dd><dt><span class="section"><a href="bank.html">2.8. Hyperledger fabric 银行应用探索</a></span></dt><dd><dl><dt><span class="section"><a href="bank.html#电汇年代">2.8.1. 电汇年代</a></span></dt><dt><span class="section"><a href="bank.html#通存通取年代">2.8.2. 通存通取年代</a></span></dt><dt><span class="section"><a href="bank.html#SWIFT.CODE">2.8.3. 跨境汇款</a></span></dt><dt><span class="section"><a href="bank.html#银行盟链">2.8.4. 区块链能做什么</a></span></dt><dt><span class="section"><a href="bank.html#银行智能合约">2.8.5. 智能合约怎么落地</a></span></dt><dt><span class="section"><a href="bank.html#银行总结">2.8.6. 总结</a></span></dt></dl></dd><dt><span class="section"><a href="hospital.html">2.9. 区块链医院应用探索</a></span></dt><dd><dl><dt><span class="section"><a href="hospital.html#idp56">2.9.1. 背景</a></span></dt><dt><span class="section"><a href="hospital.html#idp59">2.9.2. 药品和器械上链</a></span></dt><dd><dl><dt><span class="section"><a href="hospital.html#idp57">2.9.2.1. 药品上链</a></span></dt><dt><span class="section"><a href="hospital.html#idp58">2.9.2.2. 器械上链</a></span></dt></dl></dd><dt><span class="section"><a href="hospital.html#idp61">2.9.3. 电子病历上链</a></span></dt><dd><dl><dt><span class="section"><a href="hospital.html#idp60">2.9.3.1. 医学影像上链</a></span></dt></dl></dd><dt><span class="section"><a href="hospital.html#idp62">2.9.4. 健康信息</a></span></dt><dt><span class="section"><a href="hospital.html#idp63">2.9.5. 出生证明</a></span></dt><dt><span class="section"><a href="hospital.html#idp66">2.9.6. 保险</a></span></dt><dd><dl><dt><span class="section"><a href="hospital.html#idp64">2.9.6.1. 保险信息上链</a></span></dt><dt><span class="section"><a href="hospital.html#idp65">2.9.6.2. 区块链解决出险理赔过程</a></span></dt></dl></dd><dt><span class="section"><a href="hospital.html#idp67">2.9.7. 智能合约</a></span></dt></dl></dd><dt><span class="section"><a href="art.html">2.10. 艺术品区块链溯源防伪平台</a></span></dt><dd><dl><dt><span class="section"><a href="art.html#idp68">2.10.1. 都有哪些角色参与其中</a></span></dt><dt><span class="section"><a href="art.html#idp69">2.10.2. 需要运用的防伪技术</a></span></dt><dt><span class="section"><a href="art.html#idp77">2.10.3. 技术架构</a></span></dt><dd><dl><dt><span class="section"><a href="art.html#idp70">2.10.3.1. 前端技术</a></span></dt><dt><span class="section"><a href="art.html#idp71">2.10.3.2. 微服务端</a></span></dt><dt><span class="section"><a href="art.html#idp72">2.10.3.3. 存储层</a></span></dt><dt><span class="section"><a href="art.html#idp73">2.10.3.4. 消息队列层</a></span></dt><dt><span class="section"><a href="art.html#idp74">2.10.3.5. 搜索层</a></span></dt><dt><span class="section"><a href="art.html#idp75">2.10.3.6. 区块链</a></span></dt><dt><span class="section"><a href="art.html#idp76">2.10.3.7. 支持层</a></span></dt></dl></dd><dt><span class="section"><a href="art.html#nfc">2.10.4. RFID/NFC</a></span></dt><dd><dl><dt><span class="section"><a href="art.html#idp78">2.10.4.1. RFID</a></span></dt><dt><span class="section"><a href="art.html#idp79">2.10.4.2. NFC</a></span></dt><dt><span class="section"><a href="art.html#idp80">2.10.4.3. RFID/NFC 两种技术的差异</a></span></dt></dl></dd><dt><span class="section"><a href="art.html#idp81">2.10.5. 资产投资与份额持有</a></span></dt><dt><span class="section"><a href="art.html#idp82">2.10.6. 资产上链的</a></span></dt><dt><span class="section"><a href="art.html#idp99">2.10.7. 原型设计</a></span></dt><dd><dl><dt><span class="section"><a href="art.html#idp83">2.10.7.1. 注册与登录</a></span></dt><dt><span class="section"><a href="art.html#idp84">2.10.7.2. 用户角色</a></span></dt><dt><span class="section"><a href="art.html#idp85">2.10.7.3. 鉴定师角色</a></span></dt><dt><span class="section"><a href="art.html#idp97">2.10.7.4. 机构角色</a></span></dt><dd><dl><dt><span class="section"><a href="art.html#idp86">2.10.7.4.1. 地址管理</a></span></dt><dt><span class="section"><a href="art.html#idp87">2.10.7.4.2. 申请溯源标签</a></span></dt><dt><span class="section"><a href="art.html#idp88">2.10.7.4.3. 数字资产上链</a></span></dt><dt><span class="section"><a href="art.html#idp89">2.10.7.4.4. 机构成员管理</a></span></dt><dt><span class="section"><a href="art.html#idp90">2.10.7.4.5. 资产审核</a></span></dt><dt><span class="section"><a href="art.html#idp91">2.10.7.4.6. 鉴定师隶属于机构</a></span></dt><dt><span class="section"><a href="art.html#idp92">2.10.7.4.7. 评论</a></span></dt><dt><span class="section"><a href="art.html#idp96">2.10.7.4.8. 安全</a></span></dt></dl></dd><dt><span class="section"><a href="art.html#idp98">2.10.7.5. 钱包</a></span></dt></dl></dd></dl></dd></dl></div>
	
	
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="logistics"></a>2.1. 以太坊物流场景解决方案</h2></div></div></div>
	
	<p>网上谈关于物流行业区块链的文章很多，但是你会发现找遍互联网也找不到具体怎样将物流落地到区块链的文章，于是我只能自己捣鼓。</p>
	<p>背景，使用区块链记录物流信息，实现信息朔源。</p>
	<p>我想法是，将物流信息放到区块链中，实现物流中转信息的添加，当用户签收后合约关闭，不再允许增加新信息。</p>
	<p>首先，每个物流单一张合约</p>
	<p>其次，以太坊账号代表转运站，或者用户，这里我们使用5个账号分别代表不同的角色。</p>
	<pre class="programlisting">
			
pragma solidity ^0.4.20;

contract Logistics {

    enum State { New, Reviewed, Pending, Shipping, Received }

    struct Node {
        address owner;	// 中转站
        string date;    // 转运日期
        State status;   // 状态
        string message; // 留言信息
    }

    mapping (uint  =&gt; Node) stations;
    
    uint number = 1;		
    string name;			//商品名称
    bool close = false;	//合约状态
    
	function Logistics(string _name) public {
        name = _name;
	}
    function getName() public view returns(string){
        return name;
    }
    
    // 增加物流中转信息
    function put(address _owner,string _date, State _status, string _message ) public{
        if(close == false){
            Node memory node = Node(_owner,_date,_status,_message);
            stations[number] = node;
            number = number + 1;
        }
        if (_status == State.Received) {
            close = true;
        }
    }

	// 获得中转信息
    function get(uint _number) public view returns(address, string, State, string) {
        require(_number &lt; number);

        Node memory node = stations[_number];
        
		return (node.owner, node.date, node.status, node.message);
	}
	
	// 或者转中站数量
	function getNode() public view returns(uint){
	    return number;
	}
}			

			
	</pre>
	<p>保存合约到 Truffle 的 contracts/Logistics.sol</p>
	<p>部署代码</p>
	<pre class="programlisting">
			
neo@MacBook-Pro ~/ethereum/truffle % cat migrations/1_initial_migration.js

var Logistics = artifacts.require("./Logistics.sol");

module.exports = function(deployer) {
  deployer.deploy(Logistics,"Mackbook");
};			
			
	</pre>
	<p>Mackbook 就是商品名称。</p>
	<p>编译部署合约</p>
	<pre class="screen">
			
neo@MacBook-Pro ~/ethereum/truffle % truffle compile --all                
Compiling ./contracts/Logistics.sol...
Writing artifacts to ./build/contracts

neo@MacBook-Pro ~/ethereum/truffle % truffle migrate --reset              
Using network 'development'.

Running migration: 1_initial_migration.js
  Replacing Logistics...
  ... 0x14b6b6bfb84383b8325f5e97a6b7a5c1d1f5c2e162a4bd201b93a9d30cd75d8e
  Logistics: 0x1cff61b8259f05f4bbf7aa4f769321e5fa70b22d
Saving successful migration to network...
  ... 0x26d544c8db7b1cf06034963e5f5bea7b28d11e7295a018f1b80a7555c38f26e7
Saving artifacts...
			
	</pre>
	<p>启动开发环境</p>
	<pre class="screen">
			
neo@MacBook-Pro ~/ethereum/truffle % truffle develop                                                                                                               
Truffle Develop started at http://localhost:9545/

Accounts:
(0) 0x627306090abab3a6e1400e9345bc60c78a8bef57
(1) 0xf17f52151ebef6c7334fad080c5704d77216b732
(2) 0xc5fdf4076b8f3a5357c5e395ab970b5b54098fef
(3) 0x821aea9a577a9b44299b9c15c88cf3087f3b5544
(4) 0x0d1d4e623d10f9fba5db95830f7d3839406c6af2
(5) 0x2932b7a2355d6fecc4b5c0b6bd44cc31df247a2e
(6) 0x2191ef87e392377ec08e7c08eb105ef5448eced5
(7) 0x0f4f2ac550a1b4e2280d04c21cea7ebd822934b5
(8) 0x6330a553fc93768f612722bb8c2ec78ac90b3bbc
(9) 0x5aeda56215b167893e80b4fe645ba6d5bab767de

Private Keys:
(0) c87509a1c067bbde78beb793e6fa76530b6382a4c0241e5e4a9ec0a0f44dc0d3
(1) ae6ae8e5ccbfb04590405997ee2d52d2b330726137b875053c36d94e974d162f
(2) 0dbbe8e4ae425a6d2687f1a7e3ba17bc98c673636790f1b8ad91193c05875ef1
(3) c88b703fb08cbea894b6aeff5a544fb92e78a18e19814cd85da83b71f772aa6c
(4) 388c684f0ba1ef5017716adb5d21a053ea8e90277d0868337519f97bede61418
(5) 659cbb0e2411a44db63778987b1e22153c086a95eb6b18bdf89de078917abc63
(6) 82d052c865f5763aad42add438569276c00d3d88a2d062d36b2bae914d58b8c8
(7) aa3680d5d48a8283413f7a108367c7299ca73f553735860a87b08f39395618b7
(8) 0f62d96d6675f32685bbdb8ac13cda7c23436f63efbb9d07700d8669ff12b7c4
(9) 8d5366123cb560bb606379f90a0bfd4769eecc0557f1b362dcae9012b548b1e5

Mnemonic: candy maple cake sugar pudding cream honey rich smooth crumble sweet treat

truffle(develop)&gt; 
			
	</pre>
	<p>开发环境会创建10个账号用户测试。我们需要使用前5个账号，每个账号代表一个转运站，或者用户</p>
	<p>进入控制台验证合约</p>
	<pre class="programlisting">
			
var contract;
Logistics.deployed().then(function(instance){contract=instance;});
contract.getName();

contract.put("0x627306090abab3a6e1400e9345bc60c78a8bef57","2018-02-20",0,"寄包裹");
contract.get(1);
contract.put("0xf17f52151ebef6c7334fad080c5704d77216b732","2018-02-21",1,"包裹揽件");
contract.get(2);
contract.put("0xc5fdf4076b8f3a5357c5e395ab970b5b54098fef","2018-02-22",2,"运输处理中");
contract.get(3);
contract.put("0x821aea9a577a9b44299b9c15c88cf3087f3b5544","2018-02-23",3,"运输处理中");
contract.get(4);
contract.put("0x0d1d4e623d10f9fba5db95830f7d3839406c6af2","2018-02-24",4,"包裹收到");
contract.get(5);
contract.getNode();


contract.put("0x0d1d4e623d10f9fba5db95830f7d3839406c6af2","2018-02-22",5,"已经收到包裹，合约关闭，不允许在修改");
contract.get(6);
			
	</pre>
	<p>操作演示如下</p>
	<pre class="screen">
			
truffle(development)&gt; var contract;
undefined
truffle(development)&gt; Logistics.deployed().then(function(instance){contract=instance;});
undefined
truffle(development)&gt; contract.getName();
'Mackbook'
truffle(development)&gt; contract.put("0x627306090abab3a6e1400e9345bc60c78a8bef57","2018-02-20",0,"寄包裹");
{ tx: '0x74992b7cccb214600ac2f1257486053202736714cf7e9e69fb62cba692bc6592',
  receipt: 
   { transactionHash: '0x74992b7cccb214600ac2f1257486053202736714cf7e9e69fb62cba692bc6592',
     transactionIndex: 0,
     blockHash: '0xc838fb9c5352544f4d743b170d146a9ef1b1ef6a30019c33e2a77df24e808964',
     blockNumber: 86,
     gasUsed: 98633,
     cumulativeGasUsed: 98633,
     contractAddress: null,
     logs: [],
     status: 1 },
  logs: [] }
truffle(development)&gt; contract.get(1);
[ '0x627306090abab3a6e1400e9345bc60c78a8bef57',
  '2018-02-20',
  BigNumber { s: 1, e: 0, c: [ 0 ] },
  '寄包裹' ]
truffle(development)&gt; contract.put("0xf17f52151ebef6c7334fad080c5704d77216b732","2018-02-21",1,"包裹揽件");
{ tx: '0x3f8dcd5f0d9a9ec60942e6a1c73556dfcfde59354fc24474ffc8e32b9b00ac61',
  receipt: 
   { transactionHash: '0x3f8dcd5f0d9a9ec60942e6a1c73556dfcfde59354fc24474ffc8e32b9b00ac61',
     transactionIndex: 0,
     blockHash: '0x96c889cae1001265bcdf32c808770a7f9f0c325467912524c10100bc04cf8271',
     blockNumber: 87,
     gasUsed: 113889,
     cumulativeGasUsed: 113889,
     contractAddress: null,
     logs: [],
     status: 1 },
  logs: [] }
truffle(development)&gt; contract.get(2);
[ '0xf17f52151ebef6c7334fad080c5704d77216b732',
  '2018-02-21',
  BigNumber { s: 1, e: 0, c: [ 1 ] },
  '包裹揽件' ]
truffle(development)&gt; contract.put("0xc5fdf4076b8f3a5357c5e395ab970b5b54098fef","2018-02-22",2,"运输处理中");
{ tx: '0x1ebe589e6b63479f9542ba67650d63757ca45ac38cb43d395b5bc2a573d0363b',
  receipt: 
   { transactionHash: '0x1ebe589e6b63479f9542ba67650d63757ca45ac38cb43d395b5bc2a573d0363b',
     transactionIndex: 0,
     blockHash: '0x83edf5fc1e38062dafc49a21b3d9a1fa0f9ddfb0f2e749b2b1945d03360a5209',
     blockNumber: 88,
     gasUsed: 114081,
     cumulativeGasUsed: 114081,
     contractAddress: null,
     logs: [],
     status: 1 },
  logs: [] }
truffle(development)&gt; contract.get(3);
[ '0xc5fdf4076b8f3a5357c5e395ab970b5b54098fef',
  '2018-02-22',
  BigNumber { s: 1, e: 0, c: [ 2 ] },
  '运输处理中' ]
truffle(development)&gt; contract.put("0x821aea9a577a9b44299b9c15c88cf3087f3b5544","2018-02-22",3,"运输处理中");
{ tx: '0x44b2bf7853e6b4c86f732bb8f1bcee17f00e0f850530e359753b4d7c55c35b4d',
  receipt: 
   { transactionHash: '0x44b2bf7853e6b4c86f732bb8f1bcee17f00e0f850530e359753b4d7c55c35b4d',
     transactionIndex: 0,
     blockHash: '0x7e79ca2570f5045f4c226805866803f898109d238518fa1e5abe6b4ee4c1c552',
     blockNumber: 89,
     gasUsed: 114081,
     cumulativeGasUsed: 114081,
     contractAddress: null,
     logs: [],
     status: 1 },
  logs: [] }
truffle(development)&gt; contract.get(4);
[ '0x821aea9a577a9b44299b9c15c88cf3087f3b5544',
  '2018-02-22',
  BigNumber { s: 1, e: 0, c: [ 3 ] },
  '运输处理中' ]
truffle(development)&gt; contract.put("0x0d1d4e623d10f9fba5db95830f7d3839406c6af2","2018-02-22",4,"包裹收到");
{ tx: '0xb2b0223dc7cc90744a97ea002ecd468796d7596e38f8bb105c9f2103da6dfa19',
  receipt: 
   { transactionHash: '0xb2b0223dc7cc90744a97ea002ecd468796d7596e38f8bb105c9f2103da6dfa19',
     transactionIndex: 0,
     blockHash: '0xeb1051e80fe920fc166288036e6d27b38aca27144d2b636decade338f787371b',
     blockNumber: 90,
     gasUsed: 134156,
     cumulativeGasUsed: 134156,
     contractAddress: null,
     logs: [],
     status: 1 },
  logs: [] }
truffle(development)&gt; contract.get(5);
[ '0x0d1d4e623d10f9fba5db95830f7d3839406c6af2',
  '2018-02-22',
  BigNumber { s: 1, e: 0, c: [ 4 ] },
  '包裹收到' ]
truffle(development)&gt; contract.getNode();
BigNumber { s: 1, e: 0, c: [ 6 ] }
truffle(development)&gt; 
			
	</pre>
	<p>合一已经关闭，添加不会出错，但是没有数据进入区块中，使用 contract.get(6); 获取数据会抛出异常。</p>
	<pre class="screen">
			
truffle(development)&gt; contract.put("0x0d1d4e623d10f9fba5db95830f7d3839406c6af2","2018-02-22",3,"已经收到包裹，合约关闭，不允许在修改");
{ tx: '0x72999fc308f2f3bc1f70fbc919c8b08594f177318dc4e57dd5ea590248e9a6cc',
  receipt: 
   { transactionHash: '0x72999fc308f2f3bc1f70fbc919c8b08594f177318dc4e57dd5ea590248e9a6cc',
     transactionIndex: 0,
     blockHash: '0xa3d9bc835bd5de6067271baa7899c3aaada6088362371b5139f4fa7cbd9f4050',
     blockNumber: 91,
     gasUsed: 29360,
     cumulativeGasUsed: 29360,
     contractAddress: null,
     logs: [],
     status: 1 },
  logs: [] }
truffle(development)&gt; contract.get(6);
Error: VM Exception while processing transaction: revert
    at XMLHttpRequest._onHttpResponseEnd (/usr/local/lib/node_modules/truffle/build/webpack:/~/xhr2/lib/xhr2.js:509:1)
    at XMLHttpRequest._setReadyState (/usr/local/lib/node_modules/truffle/build/webpack:/~/xhr2/lib/xhr2.js:354:1)
    at XMLHttpRequestEventTarget.dispatchEvent (/usr/local/lib/node_modules/truffle/build/webpack:/~/xhr2/lib/xhr2.js:64:1)
    at XMLHttpRequest.request.onreadystatechange (/usr/local/lib/node_modules/truffle/build/webpack:/~/web3/lib/web3/httpprovider.js:128:1)
    at /usr/local/lib/node_modules/truffle/build/webpack:/~/truffle-provider/wrapper.js:134:1
    at /usr/local/lib/node_modules/truffle/build/webpack:/~/web3/lib/web3/requestmanager.js:86:1
    at Object.InvalidResponse (/usr/local/lib/node_modules/truffle/build/webpack:/~/web3/lib/web3/errors.js:38:1)
truffle(development)&gt; 
			
	</pre>
	<p>这个合约还不是很完善，仅仅是作者的想法，是否在实际项目中可行，尚未知，区块链应用场景实例的文章还比较少，只能摸索前进。</p>
</div>
		
	


	

	

	



	


	

	

	

	




</div><div xmlns="" id="disqus_thread"></div><script xmlns="">

var disqus_config = function () {
this.page.url = "http://www.netkiller.cn";  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = 'netkiller'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};

(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = '//netkiller.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script><noscript xmlns="">Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript><br xmlns="" /><script xmlns="" type="text/javascript" id="clustrmaps" src="//cdn.clustrmaps.com/map_v2.js?u=r5HG&amp;d=9mi5r_kkDC8uxG8HuY3p4-2qgeeVypAK9vMD-2P6BYM"></script><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="../区块链比较.html">上一页</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="trace.html">下一页</a></td></tr><tr><td width="40%" align="left" valign="top">1.20. Ethereum vs Hypterledger Fabic vs EOS 对比 </td><td width="20%" align="center"><a accesskey="h" href="../index.html">起始页</a></td><td width="40%" align="right" valign="top"> 2.2. 区块链防伪溯源应用场景</td></tr></table></div><script xmlns="">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-11694057-1', 'auto');
  ga('send', 'pageview');

</script><script xmlns="" async="async">
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?93967759a51cda79e49bf4e34d0b0f2c";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script xmlns="" async="async">
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script></body></html>