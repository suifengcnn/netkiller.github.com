<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>第 19 章 MySQL Server</title><link rel="stylesheet" type="text/css" href="../..//docbook.css" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><meta name="keywords" content="MySQL, PostgreSQL, Oracle, NoSQL, ER, TokyoCabinet/Tyrant, Memcache, Membase, Redis, Flare, Voldemort, LevelDB, MongoDB, GreenSQL, RDBMS, ORDBMS" /><link rel="home" href="../../index.html" title="Netkiller Database 手札" /><link rel="up" href="../index.html" title="部分 III. MySQL" /><link rel="prev" href="../index.html" title="部分 III. MySQL" /><link rel="next" href="mariadb.html" title="19.2. MariaDB" /></head><body><a xmlns="" href="//www.netkiller.cn/">Home</a> |
		<a xmlns="" href="//netkiller.github.io/">简体中文</a> |
	    <a xmlns="" href="http://netkiller.sourceforge.net/">繁体中文</a> |
	    <a xmlns="" href="/journal/index.html">杂文</a> |
	    <a xmlns="" href="//www.netkiller.cn/home/donations.html">打赏(Donations)</a> |
	    <a xmlns="" href="https://github.com/netkiller">Github</a> |
	    <a xmlns="" href="http://my.oschina.net/neochen/">OSChina 博客</a> |
	    <a xmlns="" href="https://cloud.tencent.com/developer/column/2078">云社区</a> |
	    <a xmlns="" href="https://yq.aliyun.com/u/netkiller/">云栖社区</a> |
	    <a xmlns="" href="https://www.facebook.com/bg7nyt">Facebook</a> |
	    <a xmlns="" href="http://cn.linkedin.com/in/netkiller/">Linkedin</a> |
	    <a xmlns="" href="https://zhuanlan.zhihu.com/netkiller">知乎专栏</a> |
	    <a xmlns="" href="//www.netkiller.cn/home/video.html">视频教程</a> |
	    <a xmlns="" href="//www.netkiller.cn/home/about.html">About</a><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">第 19 章 MySQL Server</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="../index.html">上一页</a> </td><th width="60%" align="center">部分 III. MySQL</th><td width="20%" align="right"> <a accesskey="n" href="mariadb.html">下一页</a></td></tr></table><hr /></div><table xmlns=""><tr><td><iframe src="//ghbtns.com/github-btn.html?user=netkiller&amp;repo=netkiller.github.io&amp;type=watch&amp;count=true&amp;size=large" height="30" width="170" frameborder="0" scrolling="0" style="width:170px; height: 30px;" allowTransparency="true"></iframe></td><td><iframe src="//ghbtns.com/github-btn.html?user=netkiller&amp;repo=netkiller.github.io&amp;type=fork&amp;count=true&amp;size=large" height="30" width="170" frameborder="0" scrolling="0" style="width:170px; height: 30px;" allowTransparency="true"></iframe></td><td><iframe src="//ghbtns.com/github-btn.html?user=netkiller&amp;type=follow&amp;count=true&amp;size=large" height="30" width="240" frameborder="0" scrolling="0" style="width:240px; height: 30px;" allowTransparency="true"></iframe></td></tr></table><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="index"></a>第 19 章 MySQL Server</h2></div></div></div><div class="toc"><p><strong>目录</strong></p><dl class="toc"><dt><span class="section"><a href="index.html#mysql.install">19.1. MySQL Installation</a></span></dt><dd><dl><dt><span class="section"><a href="index.html#mysql.ubuntu">19.1.1. Installation by apt under debian/ubuntu</a></span></dt><dd><dl><dt><span class="section"><a href="index.html#mysql-5.5.21">19.1.1.1. mysql-5.5.21-debian6.0-i686.deb</a></span></dt></dl></dd><dt><span class="section"><a href="index.html#mysql.source">19.1.2. Installation by source code</a></span></dt><dt><span class="section"><a href="index.html#mysql.binary">19.1.3. MySQL binary distribution</a></span></dt><dt><span class="section"><a href="index.html#mysql.centos">19.1.4. CentOS</a></span></dt><dd><dl><dt><span class="section"><a href="index.html#idp113">19.1.4.1. CentOS 6.2 + MySQL 5.5.25 (RPM)</a></span></dt><dt><span class="section"><a href="index.html#idp114">19.1.4.2. MySQL 8.0</a></span></dt></dl></dd><dt><span class="section"><a href="index.html#mysql.docker">19.1.5. Docker</a></span></dt><dt><span class="section"><a href="index.html#mysql-admin">19.1.6. mysql-admin</a></span></dt><dt><span class="section"><a href="index.html#mysql.yum">19.1.7. Installing MySQL on Linux Using the MySQL Yum Repository</a></span></dt><dd><dl><dt><span class="section"><a href="index.html#idp115">19.1.7.1. MySQL 5.6</a></span></dt><dt><span class="section"><a href="index.html#idp116">19.1.7.2. MySQL 5.7</a></span></dt></dl></dd><dt><span class="section"><a href="index.html#firewall">19.1.8. Firewall</a></span></dt><dt><span class="section"><a href="index.html#limit">19.1.9. Limit 状态</a></span></dt><dt><span class="section"><a href="index.html#mysql.btrfs">19.1.10. 使用 Btrfs 文件系统存储mysql数据</a></span></dt><dt><span class="section"><a href="index.html#mac">19.1.11. Mac OS</a></span></dt></dl></dd><dt><span class="section"><a href="mariadb.html">19.2. MariaDB</a></span></dt><dd><dl><dt><span class="section"><a href="mariadb.html#idp117">19.2.1. CentOS 6 YUM 安装 MariaDB</a></span></dt><dt><span class="section"><a href="mariadb.html#idp118">19.2.2. CentOS 7 安装 MariaDB</a></span></dt></dl></dd><dt><span class="section"><a href="percona.html">19.3. Percona</a></span></dt><dd><dl><dt><span class="section"><a href="percona.html#idp119">19.3.1. Percona yum Repository</a></span></dt><dt><span class="section"><a href="percona.html#xtrabackup">19.3.2. Percona XtraBackup</a></span></dt><dd><dl><dt><span class="section"><a href="percona.html#idp120">19.3.2.1. 安装 XtraBackup</a></span></dt><dt><span class="section"><a href="percona.html#idp123">19.3.2.2. innobackupex</a></span></dt><dd><dl><dt><span class="section"><a href="percona.html#idp121">19.3.2.2.1. 备份数据库</a></span></dt><dt><span class="section"><a href="percona.html#idp122">19.3.2.2.2. 恢复数据库</a></span></dt></dl></dd><dt><span class="section"><a href="percona.html#idp124">19.3.2.3. xbstream</a></span></dt><dt><span class="section"><a href="percona.html#idp125">19.3.2.4. xtrabackup</a></span></dt></dl></dd><dt><span class="section"><a href="percona.html#toolkit">19.3.3. Percona Toolkit - MySQL Management Software</a></span></dt></dl></dd><dt><span class="section"><a href="my.cnf.html">19.4. my.cnf</a></span></dt><dd><dl><dt><span class="section"><a href="my.cnf.html#my.cnf.bind-address">19.4.1. bind-address</a></span></dt><dt><span class="section"><a href="my.cnf.html#idp126">19.4.2. 禁用TCP/IP链接</a></span></dt><dt><span class="section"><a href="my.cnf.html#idp127">19.4.3. 配置字符集</a></span></dt><dt><span class="section"><a href="my.cnf.html#idp128">19.4.4. 最大链接数 max_connections</a></span></dt><dt><span class="section"><a href="my.cnf.html#idp129">19.4.5. 默认引擎 storage-engine</a></span></dt><dt><span class="section"><a href="my.cnf.html#idp130">19.4.6. max_allowed_packet</a></span></dt><dt><span class="section"><a href="my.cnf.html#idp131">19.4.7. skip-name-resolve</a></span></dt><dt><span class="section"><a href="my.cnf.html#idp132">19.4.8. timeout</a></span></dt><dt><span class="section"><a href="my.cnf.html#replication">19.4.9. 与复制有关的参数</a></span></dt><dd><dl><dt><span class="section"><a href="my.cnf.html#idp133">19.4.9.1. 用于主库的选项 Master</a></span></dt><dt><span class="section"><a href="my.cnf.html#idp134">19.4.9.2. 用于从库的选项 Slave </a></span></dt><dt><span class="section"><a href="my.cnf.html#idp135">19.4.9.3. 逃过错误</a></span></dt></dl></dd><dt><span class="section"><a href="my.cnf.html#idp136">19.4.10. 与 InnoDB 有关的配置项</a></span></dt><dt><span class="section"><a href="my.cnf.html#idp137">19.4.11. EVENT 设置</a></span></dt><dt><span class="section"><a href="my.cnf.html#idp138">19.4.12. 日志</a></span></dt><dt><span class="section"><a href="my.cnf.html#idp139">19.4.13. MySQL 5.7 my.cnf 实例</a></span></dt><dt><span class="section"><a href="my.cnf.html#idp140">19.4.14. Example for my.cnf</a></span></dt></dl></dd><dt><span class="section"><a href="plugin.html">19.5. MySQL Plugin</a></span></dt><dd><dl><dt><span class="section"><a href="plugin.html#idp141">19.5.1. validate_password</a></span></dt><dt><span class="section"><a href="plugin.html#netkiller.mysql.images">19.5.2. MySQL Images manager</a></span></dt><dt><span class="section"><a href="plugin.html#netkiller.mysql.fifo">19.5.3. MySQL fifo</a></span></dt><dt><span class="section"><a href="plugin.html#netkiller.mysql.out2file">19.5.4. 内容输出到文本插件</a></span></dt></dl></dd><dt><span class="section"><a href="replication.html">19.6. Replication</a></span></dt><dd><dl><dt><span class="section"><a href="replication.html#master.slave">19.6.1. Master Slave</a></span></dt><dd><dl><dt><span class="section"><a href="replication.html#replication.master">19.6.1.1. Master</a></span></dt><dt><span class="section"><a href="replication.html#replication.slave">19.6.1.2. Slave</a></span></dt><dt><span class="section"><a href="replication.html#replication.testing">19.6.1.3. Testing</a></span></dt><dt><span class="section"><a href="replication.html#replication.db">19.6.1.4. 将现有数据库迁移到主从结构数据库</a></span></dt><dt><span class="section"><a href="replication.html#replication.privi">19.6.1.5. 主从复制安全问题</a></span></dt></dl></dd><dt><span class="section"><a href="replication.html#master.master">19.6.2. Master Master(主主)</a></span></dt><dd><dl><dt><span class="section"><a href="replication.html#idp142">19.6.2.1. Master A</a></span></dt><dt><span class="section"><a href="replication.html#idp143">19.6.2.2. Master B</a></span></dt><dt><span class="section"><a href="replication.html#idp144">19.6.2.3. 将Master A 数据库 同步到 Master B 两端数据库内容保持一致</a></span></dt><dt><span class="section"><a href="replication.html#idp145">19.6.2.4. Master A - B 同步两端数据库</a></span></dt><dt><span class="section"><a href="replication.html#idp146">19.6.2.5. Master A 数据库解除只读权限</a></span></dt><dt><span class="section"><a href="replication.html#idp147">19.6.2.6. 查看主主的工作状态</a></span></dt></dl></dd><dt><span class="section"><a href="replication.html#semisynchronous">19.6.3. Semisynchronous Replication</a></span></dt><dd><dl><dt><span class="section"><a href="replication.html#idp148">19.6.3.1. Master</a></span></dt><dt><span class="section"><a href="replication.html#idp149">19.6.3.2. Slave 配置</a></span></dt><dt><span class="section"><a href="replication.html#idp150">19.6.3.3. 卸载插件</a></span></dt><dt><span class="section"><a href="replication.html#idp151">19.6.3.4. my.cnf</a></span></dt></dl></dd><dt><span class="section"><a href="replication.html#multi-master">19.6.4. multi-master replication</a></span></dt><dt><span class="section"><a href="replication.html#multi-source">19.6.5. multi-source replication</a></span></dt><dt><span class="section"><a href="replication.html#replication.error">19.6.6. 与复制有关的问题</a></span></dt><dd><dl><dt><span class="section"><a href="replication.html#replication.error">19.6.6.1. 主从不同步问题</a></span></dt><dt><span class="section"><a href="replication.html#replication.expire-logs-days">19.6.6.2. mysql-bin 清理问题</a></span></dt><dt><span class="section"><a href="replication.html#idp152">19.6.6.3. 跳过 Last_Errno</a></span></dt><dt><span class="section"><a href="replication.html#idp153">19.6.6.4. 重置Slave</a></span></dt></dl></dd><dt><span class="section"><a href="replication.html#GTID">19.6.7. GTID</a></span></dt><dd><dl><dt><span class="section"><a href="replication.html#idp154">19.6.7.1. Master</a></span></dt><dt><span class="section"><a href="replication.html#idp155">19.6.7.2. Slave</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="cluster.html">19.7. MySQL Custer</a></span></dt><dd><dl><dt><span class="section"><a href="cluster.html#cluster.mgm">19.7.1. Management node (MGM node)</a></span></dt><dt><span class="section"><a href="cluster.html#cluster.data">19.7.2. Data node</a></span></dt><dt><span class="section"><a href="cluster.html#cluster.sql">19.7.3. SQL node</a></span></dt><dt><span class="section"><a href="cluster.html#cluster.start">19.7.4. Starting</a></span></dt><dt><span class="section"><a href="cluster.html#cluster.shut">19.7.5. Shutdown</a></span></dt><dt><span class="section"><a href="cluster.html#cluster.testing">19.7.6. Testing</a></span></dt></dl></dd><dt><span class="section"><a href="mysql-proxy.html">19.8. MySQL Proxy</a></span></dt><dd><dl><dt><span class="section"><a href="mysql-proxy.html#idp156">19.8.1. Ubuntu</a></span></dt><dt><span class="section"><a href="mysql-proxy.html#idp158">19.8.2. CentOS</a></span></dt><dd><dl><dt><span class="section"><a href="mysql-proxy.html#idp157">19.8.2.1. FAQ</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="router.html">19.9. MySQL Router</a></span></dt><dd><dl><dt><span class="section"><a href="router.html#idp159">19.9.1. 安装 MySQL Router</a></span></dt><dt><span class="section"><a href="router.html#idp162">19.9.2. 配置 MySQL Router</a></span></dt><dd><dl><dt><span class="section"><a href="router.html#idp160">19.9.2.1. 主备配置</a></span></dt><dt><span class="section"><a href="router.html#idp161">19.9.2.2. 负载均衡配置</a></span></dt></dl></dd><dt><span class="section"><a href="router.html#idp163">19.9.3. MySQL Router ， Haproxy，LVS 的选择</a></span></dt></dl></dd><dt><span class="section"><a href="variables.html">19.10. variables</a></span></dt><dd><dl><dt><span class="section"><a href="variables.html#time_zone">19.10.1. time_zone</a></span></dt><dt><span class="section"><a href="variables.html#sql_mode">19.10.2. sql_mode</a></span></dt><dd><dl><dt><span class="section"><a href="variables.html#idp164">19.10.2.1. 设置 sql_mode</a></span></dt><dt><span class="section"><a href="variables.html#idp165">19.10.2.2. 查看 sql_mode</a></span></dt><dt><span class="section"><a href="variables.html#idp166">19.10.2.3. 兼容早起 MySQL 版本</a></span></dt><dt><span class="section"><a href="variables.html#idp167">19.10.2.4. 5.7.16</a></span></dt></dl></dd><dt><span class="section"><a href="variables.html#wait_timeout">19.10.3. wait_timeout</a></span></dt><dt><span class="section"><a href="variables.html#table_lock_wait_timeout">19.10.4. table_lock_wait_timeout</a></span></dt><dt><span class="section"><a href="variables.html#low_priority_updates">19.10.5. low_priority_updates</a></span></dt><dt><span class="section"><a href="variables.html#idp168">19.10.6. collation_server</a></span></dt><dt><span class="section"><a href="variables.html#character_set">19.10.7. character_set</a></span></dt><dt><span class="section"><a href="variables.html#datadir">19.10.8. datadir</a></span></dt><dt><span class="section"><a href="variables.html#plugin_dir">19.10.9. plugin_dir</a></span></dt><dt><span class="section"><a href="variables.html#storage_engine">19.10.10. storage_engine</a></span></dt><dt><span class="section"><a href="variables.html#timeout">19.10.11. timeout</a></span></dt><dt><span class="section"><a href="variables.html#max_connections">19.10.12. max_connections</a></span></dt></dl></dd><dt><span class="section"><a href="status.html">19.11. SHOW COMMAND</a></span></dt><dd><dl><dt><span class="section"><a href="status.html#version">19.11.1. 查看版本</a></span></dt><dt><span class="section"><a href="status.html#show.status">19.11.2. status</a></span></dt><dd><dl><dt><span class="section"><a href="status.html#show.status">19.11.2.1. show status</a></span></dt><dt><span class="section"><a href="status.html#idp169">19.11.2.2. show master status</a></span></dt><dt><span class="section"><a href="status.html#idp170">19.11.2.3. show slave status</a></span></dt><dt><span class="section"><a href="status.html#idp171">19.11.2.4. show plugins</a></span></dt></dl></dd><dt><span class="section"><a href="status.html#show.processlist">19.11.3. show processlist</a></span></dt><dt><span class="section"><a href="status.html#binary">19.11.4. binary 日志</a></span></dt><dt><span class="section"><a href="status.html#threads">19.11.5. 线程的使用情况</a></span></dt><dt><span class="section"><a href="status.html#databases">19.11.6. DATABASES</a></span></dt><dt><span class="section"><a href="status.html#table">19.11.7. TABLE</a></span></dt><dt><span class="section"><a href="status.html#created_tmp">19.11.8. 临时表</a></span></dt><dt><span class="section"><a href="status.html#sort">19.11.9. 排序统计信息</a></span></dt><dt><span class="section"><a href="status.html#key_read">19.11.10. Key 状态</a></span></dt><dt><span class="section"><a href="status.html#function">19.11.11. FUNCTION</a></span></dt><dt><span class="section"><a href="status.html#procedure">19.11.12. PROCEDURE</a></span></dt><dt><span class="section"><a href="status.html#triggers">19.11.13. TRIGGERS</a></span></dt><dt><span class="section"><a href="status.html#events">19.11.14. EVENTS</a></span></dt><dt><span class="section"><a href="status.html#engines">19.11.15. 引擎(ENGINES)</a></span></dt><dt><span class="section"><a href="status.html#collation">19.11.16. 字符集(Collation)</a></span></dt><dt><span class="section"><a href="status.html#show.grants">19.11.17. SHOW GRANTS</a></span></dt><dt><span class="section"><a href="status.html#validate_password">19.11.18. validate_password</a></span></dt></dl></dd><dt><span class="section"><a href="monitoring.html">19.12. Monitoring</a></span></dt><dd><dl><dt><span class="section"><a href="monitoring.html#mon.prog">19.12.1. Analysis and Optimization</a></span></dt><dd><dl><dt><span class="section"><a href="monitoring.html#mytop">19.12.1.1. mytop - top like query monitor for MySQL</a></span></dt><dt><span class="section"><a href="monitoring.html#mtop">19.12.1.2. mtop - MySQL terminal based query monitor</a></span></dt><dt><span class="section"><a href="monitoring.html#idp172">19.12.1.3. innotop</a></span></dt><dt><span class="section"><a href="monitoring.html#mysqlreport">19.12.1.4. mysqlreport - A friendly report of important MySQL status values</a></span></dt><dt><span class="section"><a href="monitoring.html#mysqltuner">19.12.1.5. mysqltuner - MySQL configuration assistant</a></span></dt></dl></dd><dt><span class="section"><a href="monitoring.html#monitoring.munin">19.12.2. Munin</a></span></dt><dt><span class="section"><a href="monitoring.html#monitoring.cacti">19.12.3. Cacti</a></span></dt><dt><span class="section"><a href="monitoring.html#mysql.snmp">19.12.4. Monitoring MySQL with SNMP</a></span></dt></dl></dd></dl></div>
	
	

<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="mysql.install"></a>19.1. MySQL Installation</h2></div></div></div>
	
	<p>http://downloads.mysql.com/archives.php</p>
	<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="mysql.ubuntu"></a>19.1.1. Installation by apt under debian/ubuntu</h3></div></div></div>
		
		<p>安装环境 ubuntu 17.10</p>
		<pre class="screen">
			sudo apt install mysql-server mysql-client
		</pre>
		<p>New password for the MySQL "root" user</p>
		<pre class="screen">
		
         ┌──────────────────────┤ Configuring mysql-server-5.7 ├─────────────────────┐
         │ While not mandatory, it is highly recommended that you set a password for the MySQL administrative "root" user.  │
         │                                                                                                                  │
         │ If that field is left blank, the password will not be changed.                                                   │
         │                                                                                                                  │
         │ New password for the MySQL "root" user:                                                                          │
         │                                                                                                                  │
         │ ****____________________________________________________________________________________________________________ │
         │                                                                                                                  │
         │                                                      &lt;Ok&gt;                                                        │
         │                                                                                                                  │
         └─────────────────────────────────────────────────────────────┘
		
		</pre>
		<p>Repeat password for the MySQL "root" user</p>
		<pre class="screen">
		
         ┌───┤ Configuring mysql-server-5.7 ├────┐
         │                                             │
         │                                             │
         │ Repeat password for the MySQL "root" user:  │
         │                                             │
         │ ****_______________________________________ │
         │                                             │
         │                   &lt;Ok&gt;                      │
         │                                             │
         └─────────────────────────┘
         
		</pre>
		<p>尝试登录，验证是否安装成功</p>
		<pre class="screen">
		
# mysql -udbuser -p
Enter password:

mysql&gt; SHOW GRANTS;
+----------------------------------------------------------------------------------------------------------------------------------------+
| Grants for root@localhost                                                                                                              |
+----------------------------------------------------------------------------------------------------------------------------------------+
| GRANT ALL PRIVILEGES ON *.* TO 'root'@'localhost' IDENTIFIED BY PASSWORD '*C6325DAF39AE6CC34E960D3C65F1398FE467E1D0' WITH GRANT OPTION |
+----------------------------------------------------------------------------------------------------------------------------------------+
1 row in set (0.00 sec)

GRANT ALL PRIVILEGES ON example.* TO 'dbuser'@'localhost' IDENTIFIED BY '******' WITH GRANT OPTION;
FLUSH PRIVILEGES;
		
		</pre>
		<p>配置监听IP地址，默认数据库只能从 127.0.0.1访问</p>
		<pre class="screen">
			neo@netkiller /etc/mysql/mysql.conf.d % vim
			/etc/mysql/mysql.conf.d/mysqld.cnf

			bind-address = 0.0.0.0
		</pre>
		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="mysql-5.5.21"></a>19.1.1.1. mysql-5.5.21-debian6.0-i686.deb</h4></div></div></div>
			
			<pre class="screen">
		
sudo apt-get install libaio1


sudo groupadd mysql
sudo useradd -r -g mysql mysql

sudo dpkg -i mysql-5.5.21-debian6.0-i686.deb

cd /opt/mysql/
sudo chown -R mysql .
sudo chgrp -R mysql .

cd server-5.5/

sudo support-files/binary-configure

sudo chown -R mysql data

# Next command is optional
shell&gt; cp support-files/my-medium.cnf /etc/my.cnf

shell&gt; bin/mysqld_safe --user=mysql &amp;

# Next command is optional
sudo cp support-files/mysql.server /etc/init.d/mysql
		
			</pre>
		</div>
	</div>
	<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="mysql.source"></a>19.1.2. Installation by source code</h3></div></div></div>
		
		<pre class="screen">
		
./configure \
--prefix=/usr/local/$MYSQL_DIR \
--enable-assembler \
--enable-local-infile \
--with-charset=utf8 \
--with-collation=utf8_general_ci \
--with-extra-charsets=none \
--with-openssl \
--with-pthread \
--with-unix-socket-path=/var/lib/mysql/mysql.sock \
--with-mysqld-user=mysql \
--with-mysqld-ldflags \
--with-client-ldflags \
--with-comment \
--with-big-tables \
--without-ndb-debug \
--without-docs \
--without-debug \
--without-bench

make &amp;&amp; make install
		
		</pre>
		<p>/usr/local/$MYSQL_DIR/bin/mysql_install_db</p>
		<p>other option</p>
		<pre class="screen">
			--without-isam
			--without-innodb
			--without-ndbcluster
			--without-blackhole
			--without-ibmdb2i
			--without-federated
			--without-example
			--without-comment
			--localstatedir=/usr/local/mysql/data
		</pre>
	</div>
	<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="mysql.binary"></a>19.1.3. MySQL binary distribution</h3></div></div></div>
		
		<pre class="screen">
		
shell&gt; groupadd mysql
shell&gt; useradd -r -g mysql mysql
shell&gt; cd /usr/local
shell&gt; tar zxvf /path/to/mysql-VERSION-OS.tar.gz
shell&gt; ln -s full-path-to-mysql-VERSION-OS mysql
shell&gt; cd mysql
shell&gt; chown -R mysql .
shell&gt; chgrp -R mysql .
shell&gt; scripts/mysql_install_db --user=mysql
shell&gt; chown -R root .
shell&gt; chown -R mysql data
# Next command is optional
shell&gt; cp support-files/my-medium.cnf /etc/my.cnf
shell&gt; bin/mysqld_safe --user=mysql &amp;
# Next command is optional
shell&gt; cp support-files/mysql.server /etc/init.d/mysql.server
		
		</pre>
		<p>install core database</p>
		<pre class="screen">
		
[root@test mysql]# ./scripts/mysql_install_db
Installing MySQL system tables...
100428 23:16:20 [Warning] '--skip-locking' is deprecated and will be removed in a future release. Please use '--skip-external-locking' instead.
OK
Filling help tables...
100428 23:16:20 [Warning] '--skip-locking' is deprecated and will be removed in a future release. Please use '--skip-external-locking' instead.
OK

To start mysqld at boot time you have to copy
support-files/mysql.server to the right place for your system

PLEASE REMEMBER TO SET A PASSWORD FOR THE MySQL root USER !
To do so, start the server, then issue the following commands:

./bin/mysqladmin -u root password 'new-password'
./bin/mysqladmin -u root -h db.example.com password 'new-password'

Alternatively you can run:
./bin/mysql_secure_installation

which will also give you the option of removing the test
databases and anonymous user created by default.  This is
strongly recommended for production servers.

See the manual for more instructions.

You can start the MySQL daemon with:
cd . ; ./bin/mysqld_safe &amp;

You can test the MySQL daemon with mysql-test-run.pl
cd ./mysql-test ; perl mysql-test-run.pl

Please report any problems with the ./bin/mysqlbug script!
		
		</pre>
		<p>set root's password</p>
		<pre class="screen">
			[root@test mysql]# cp support-files/mysql.server
			/etc/init.d/mysqld
			[root@test mysql]# /etc/init.d/mysqld start
			Starting MySQL. [ OK ]

			[root@test mysql]# ./bin/mysqladmin -u root
			password 'chen'
			[root@test mysql]# ./bin/mysqladmin -u root -h
			db.example.com password 'chen'
		</pre>
		<p>test</p>
		<pre class="screen">
		
[root@test mysql]# ./bin/mysql -uroot -pchen
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 3
Server version: 5.1.45 MySQL Community Server (GPL)

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql&gt;
		
		</pre>
	</div>
	
	<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="mysql.centos"></a>19.1.4. CentOS</h3></div></div></div>
		
		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp113"></a>19.1.4.1. CentOS 6.2 + MySQL 5.5.25 (RPM)</h4></div></div></div>
			
			<p>准备下面的软件包</p>
			<pre class="screen">
# ls -1
MySQL-client-5.5.25-1.el6.x86_64.rpm
MySQL-devel-5.5.25-1.el6.x86_64.rpm
MySQL-server-5.5.25-1.el6.x86_64.rpm
MySQL-shared-5.5.25-1.el6.x86_64.rpm
MySQL-shared-compat-5.5.25-1.el6.x86_64.rpm
			</pre>
			<p>使用 yum 本地安装 rpm, yum 可以帮你解决依赖于冲突 </p>
			<pre class="screen">
# yum localinstall MySQL-*
			</pre>
			<pre class="screen">
# /etc/init.d/mysql start
Starting MySQL... SUCCESS!

# /usr/bin/mysqladmin -u root password 'tUG26WSslP30bkbwtMhn'
			</pre>
		</div>
		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp114"></a>19.1.4.2. MySQL 8.0</h4></div></div></div>
			
			<p>安装</p>
			<pre class="screen">
			
curl -s https://raw.githubusercontent.com/oscm/shell/master/database/mysql/8.0/server.sh | bash
			
			</pre>
			<p>启动</p>
			<pre class="screen">
			
systemctl enable mysql
systemctl start mysql
			
			</pre>
			<p>必须修改密码后才能使用</p>
			<pre class="screen">
			
[root@netkiller ~]# grep "A temporary password" /var/log/mysqld.log
2018-04-03T02:24:16.935070Z 1 [Note] A temporary password is generated for root@localhost: kMA*d&lt;e#Q3EC
2018-04-20T03:36:31.935143Z 5 [Note] [MY-010454] [Server] A temporary password is generated for root@localhost: MqatK=hae5F#

[root@netkiller ~]# mysqladmin -u root -p'MqatK=hae5F#' password
mysqladmin: [Warning] Using a password on the command line interface can be insecure.
New password:
Confirm new password:
Warning: Since password will be sent to server in plain text, use ssl connection to ensure password safety.

[root@netkiller ~]# mysql -uroot -p
Enter password:
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 10
Server version: 8.0.11 MySQL Community Server - GPL

Copyright (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql&gt;

			
			</pre>
			<p>创建用户</p>
			<pre class="screen">
			
mysql&gt; CREATE USER 'root'@'%' IDENTIFIED BY 'MQiEge1ikst7S_6tlXzBOmt_4b';
Query OK, 0 rows affected (0.05 sec)

mysql&gt; GRANT ALL ON *.* TO 'root'@'%';
Query OK, 0 rows affected (0.03 sec)

			
			</pre>
		</div>
	</div>
	<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="mysql.docker"></a>19.1.5. Docker</h3></div></div></div>
		
		<pre class="screen">
		
docker run --name mysql -d \
    --restart always \
    -e MYSQL_ROOT_PASSWORD=123456 \
    -e MYSQL_DATABASE=test \
    -e MYSQL_USER=test \
    -e MYSQL_PASSWORD=test \
    -p 127.0.0.1:3306:3306 \
    mysql:latest		
		
		</pre>
	</div>
	<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="mysql-admin"></a>19.1.6. mysql-admin</h3></div></div></div>
		
		<pre class="screen">
$ sudo apt-get install mysql-admin
		</pre>
		<p>运行mysql-admin</p>
		<pre class="screen">
/usr/bin/mysql-admin
		</pre>
		<p>运行 mysql-query-browser </p>
		<pre class="screen">
mysql-query-browser --query="SELECT * FROM users"
		</pre>
	</div>
	<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="mysql.yum"></a>19.1.7. Installing MySQL on Linux Using the MySQL Yum Repository</h3></div></div></div>
		
		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp115"></a>19.1.7.1. MySQL 5.6</h4></div></div></div>
			
			<p>http://dev.mysql.com/doc/mysql-repo-excerpt/5.6/en/linux-installation-yum-repo.html</p>
			<pre class="screen">
yum localinstall http://dev.mysql.com/get/mysql-community-release-el6-5.noarch.rpm
			</pre>
			<p>安装MySQL Server</p>
			<pre class="screen">
yum install mysql-server
chkconfig mysqld on
service mysqld start		
			</pre>
			<p>修改root密码</p>
			<pre class="screen">
mysqladmin -u root password 'new-password'		
			</pre>
			<p>安全设置向导</p>
			<pre class="screen">
/usr/bin/mysql_secure_installation		
			</pre>
		</div>
		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp116"></a>19.1.7.2. MySQL 5.7</h4></div></div></div>
			
			<pre class="screen">
			
yum localinstall -y https://dev.mysql.com/get/mysql57-community-release-el7-11.noarch.rpm
yum install mysql-server -y
systemctl enable mysqld
systemctl start mysqld

cp /etc/my.cnf{,.original}

cat &gt;&gt; /etc/security/limits.d/20-nofile.conf &lt;&lt;EOF

mysql soft nofile 40960
mysql hard nofile 40960
EOF

cat &gt;&gt; /etc/my.cnf.d/default.cnf &lt;&lt;EOF
[mysqld]
skip-name-resolve
max_connections=8192
default-storage-engine=INNODB

#wait_timeout=30
#interactive_timeout=30

character-set-server=utf8
collation_server=utf8_general_ci
init_connect='SET NAMES utf8'

explicit_defaults_for_timestamp=true

query_cache_type=1
query_cache_size=512M

[client]
character_set_client=utf8

EOF
			
			</pre>
			<p>MySQL 5.7 会随机分配一个密码给用户</p>
			<pre class="screen">
grep "A temporary password" /var/log/mysqld.log
			</pre>
			<p>登陆后修改密码</p>
			<pre class="screen">
ALTER USER root@localhost identified by 'MQiEge1ikst7S_6tlXzBOmt_4b';
ALTER USER root@localhost PASSWORD EXPIRE NEVER;
			</pre>
		</div>
	</div>
	
	<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="firewall"></a>19.1.8. Firewall</h3></div></div></div>
		
		<p>iptables</p>
		<pre class="screen">
iptables -A INPUT -i eth0 -p tcp -s xxx.xxx.xxx.xxx --dport 3306 -j ACCEPT
		</pre>
	</div>
	<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="limit"></a>19.1.9. Limit 状态</h3></div></div></div>
		
		<pre class="screen">
$ sudo cat /proc/`pidof mysqld`/limits
Limit                     Soft Limit           Hard Limit           Units     
Max cpu time              unlimited            unlimited            seconds   
Max file size             unlimited            unlimited            bytes     
Max data size             unlimited            unlimited            bytes     
Max stack size            10485760             unlimited            bytes     
Max core file size        0                    unlimited            bytes     
Max resident set          unlimited            unlimited            bytes     
Max processes             62662                62662                processes 
Max open files            20480                20480                files     
Max locked memory         65536                65536                bytes     
Max address space         unlimited            unlimited            bytes     
Max file locks            unlimited            unlimited            locks     
Max pending signals       62662                62662                signals   
Max msgqueue size         819200               819200               bytes     
Max nice priority         0                    0                    
Max realtime priority     0                    0                    
Max realtime timeout      unlimited            unlimited            us   		
		</pre>
	</div>
	<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="mysql.btrfs"></a>19.1.10. 使用 Btrfs 文件系统存储mysql数据</h3></div></div></div>
		
		<pre class="screen">
		
#!/bin/sh
systemctl stop mysqld

btrfs subvolume create /srv/@mysql
btrfs subvolume list /srv/

UUID=$(blkid | grep btrfs | sed -e 's/.*UUID="\([^"]*\)".*/\1/')
# UUID=786f570d-fe5c-4d5f-832a-c1b0963dd4e6 /srv btrfs defaults 1 1
cat &lt;&lt; EOF &gt;&gt; /etc/fstab
UUID=${UUID} /var/lib/mysql  btrfs   noatime,nodiratime,subvol=@mysql 0 2
EOF

mkdir /tmp/mysql
mv /var/lib/mysql/* /tmp/mysql/

mount /var/lib/mysql/
chown mysql:mysql /var/lib/mysql

mv /tmp/mysql/* /var/lib/mysql/

systemctl start mysqld
		
		</pre>
	</div>
	<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="mac"></a>19.1.11. Mac OS</h3></div></div></div>
		
		<pre class="screen">
brew install mysql
		</pre>
		<p>启动</p>
		<pre class="screen">
brew services start mysql
		</pre>
	</div>
</div>

	

	

	
	

	

	


	

	

	


	


</div><div xmlns="" id="disqus_thread"></div><script xmlns="">

var disqus_config = function () {
this.page.url = "http://www.netkiller.cn";  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = 'netkiller'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};

(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = '//netkiller.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script><noscript xmlns="">Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript><br xmlns="" /><script xmlns="" type="text/javascript" id="clustrmaps" src="//cdn.clustrmaps.com/map_v2.js?u=r5HG&amp;d=9mi5r_kkDC8uxG8HuY3p4-2qgeeVypAK9vMD-2P6BYM"></script><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="../index.html">上一页</a> </td><td width="20%" align="center"><a accesskey="u" href="../index.html">上一级</a></td><td width="40%" align="right"> <a accesskey="n" href="mariadb.html">下一页</a></td></tr><tr><td width="40%" align="left" valign="top">部分 III. MySQL </td><td width="20%" align="center"><a accesskey="h" href="../../index.html">起始页</a></td><td width="40%" align="right" valign="top"> 19.2. MariaDB</td></tr></table></div><script xmlns="">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-11694057-1', 'auto');
  ga('send', 'pageview');

</script><script xmlns="" async="async">
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?93967759a51cda79e49bf4e34d0b0f2c";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script xmlns="" async="async">
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script><script xmlns="" type="text/javascript" src="/js/q.js" async="async"></script></body></html>